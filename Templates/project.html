{% extends 'project-base.html' %}
{% block content %}
            <div class="row">
                <div class="col-md-8">
                    <div class="input-group search">
                        <span class="input-group-addon" id="sizing-addon2"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></span>
                        <input type="text" class="form-control" placeholder="请输入项目名称" aria-describedby="sizing-addon2">
                    </div>
                </div>
                {% if request.user.is_superuser %}
                <div class="col-md-4">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".edit-project-modal">新建项目</button>
                </div>
                {% endif %}
            </div>
            <form class="form-signin" action="" method="post">
            <div class="dateContainer">
                起止时间：
                <select class="form-control dateSelect" name="startyear">
                    <option>2016</option>
                    <option>2017</option>
                    <option>2018</option>
                    <option>2019</option>
                    <option>2020</option>
                </select>
                <select class="form-control dateSelect" name="startmonth">
                    <option>1月</option>
                    <option>2月</option>
                    <option>3月</option>
                    <option>4月</option>
                    <option>5月</option>
                    <option>6月</option>
                    <option>7月</option>
                    <option>8月</option>
                    <option>9月</option>
                    <option>10月</option>
                    <option>11月</option>
                    <option>12月</option>
                </select>
                 ～
                <select class="form-control dateSelect" name="endyear">
                    <option>2016</option>
                    <option>2017</option>
                    <option>2018</option>
                    <option>2019</option>
                    <option>2020</option>
                </select>
                <select class="form-control dateSelect" name="endmonth">
                    <option>1月</option>
                    <option>2月</option>
                    <option>3月</option>
                    <option>4月</option>
                    <option>5月</option>
                    <option>6月</option>
                    <option>7月</option>
                    <option>8月</option>
                    <option>9月</option>
                    <option>10月</option>
                    <option>11月</option>
                    <option>12月</option>
                </select>

                <span class="pm">项目经理：</span>
                <select class="form-control dateSelect" name="manager">
                    <option>全部</option>
                    {% for manager in all_managers %}
                        <option>{{ manager }}</option>
                    {% endfor %}
                </select>
                <input class="btn btn-primary" type="submit" value="搜索"></input>
{#                <button type="button" class="btn btn-primary" href="?start=2018-2-10&end=2018-3-20&manager=''">搜索</button>#}
            </div>
            {% csrf_token %}
            </form>



            <table class="table table-bordered table-hover">
                <thead >
                <tr>
                    <th>项目名称</th>
                    <th>项目经理</th>
                    <th>项目状态</th>
                    <th>起止时间</th>
                </tr>
                </thead>
                <tbody>
                {% for project in all_project.object_list %}
                    <tr>
                    <th scope="row"><a href="{% url 'project:project_detail' project.id %}">{{ project.name }}</a></th>
                    <td>{{ project.manager.username }}</td>
                    <td>{{ project.get_status_display }}</td>
                    <td>{{ project.start_time }} - {{ project.end_time }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>

            {% if all_project.has_previous %}
            <a href="?{{ all_project.previous_page_number.querystring }}" class="prev">&lsaquo;&lsaquo; 前一页</a>
        {% else %}
            <span class="disabled prev">&lsaquo;&lsaquo; 前一页</span>
        {% endif %}
            {% for page in all_project.pages %}
            {% if page %}
            {% ifequal page all_project.number %}
                <span class="current page">{{ page }}</span>
            {% else %}
                <a href="?{{ page.querystring }}" class="page">{{ page }}</a>
            {% endifequal %}
            {% else %}
            ...
            {% endif %}
        {% endfor %}
            {% if all_project.has_next %}
            <a href="?{{ all_project.next_page_number.querystring }}" class="next">下一页 &rsaquo;&rsaquo;</a>
        {% else %}
            <span class="disabled next">下一页 &rsaquo;&rsaquo;</span>
        {% endif %}

    <!-- create project -->
    <div class="modal fade edit-project-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title title" id="createProjectModalLabel">项目详情</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label for="projectName" class="col-md-3 control-label" name="name">项目名称：</label>
                            <div class="col-sm-3">
                                <input class="form-control" id="projectName" value="">
                            </div>

                            <label for="projectStatus" class="col-md-3 control-label">项目经理：</label>
                            <select class="col-md-9 form-control projectStatus" id="projectPm" name="status">
                                {% for user in users %}
                                    {% if user.id == project.manager.id %}
                                       <option value="{{ user.id }}" selected>{{ user.username }}</option>
                                    {% else %}
                                       <option value="{{ user.id }}">{{ user.username }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>

                        </div>
                        <div class="form-group">
                            <label for="projectDateFrom" class="col-md-3 control-label" name="start_time">创建时间：</label>
                            <div class="col-sm-3">
                                <input class="form-control" id="projectDateFrom" value="{{ project.start_time }}">
                            </div>
                            <label for="projectDateTo" class="col-md-3 control-label" name="end_time">终止时间：</label>
                            <div class="col-sm-3">
                                <input class="form-control" type="text" id="projectDateTo" value="{{ project.end_time }}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="projectStatus" class="col-md-3 control-label">项目状态：</label>
                            <select class="col-md-9 form-control projectStatus" id="projectStatus" name="status">
                                <option value="executing">执行</option>
                                <option value="acceptance">验收</option>
                                <option value="release">发布</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-6">
                                <a class="btn btn-sm btn-primary btn-block" href="javascript:editeProject('0')">确定</a>
                            </div>
                            <div class="col-sm-6">
                                <a class="btn btn-sm btn-primary btn-block" href="javascript:void(0)" data-dismiss="modal">取消</a>
                            </div>
                        </div>
                        {% csrf_token %}
                    </form>
                </div>
            </div>
        </div>

        <script>
                var i18nObject = {
                        previousMonth : "上个月",
                        nextMonth     : "下个月",
                        months        : ["一月",
                                        "二月",
                                        "三月",
                                        "四月",
                                        "五月",
                                        "六月",
                                        "七月",
                                        "八月",
                                        "九月",
                                        "十月",
                                        "十一月",
                                        "十二月"],
                        weekdays      : ["周日",
                                        "周一",
                                        "周二",
                                        "周三",
                                        "周四",
                                        "周五",
                                        "周六"],
                        weekdaysShort : ["日",
                                        "一",
                                        "二",
                                        "三",
                                        "四",
                                        "五",
                                        "六"]
                    };
                new Pikaday(
                {
                    field: document.getElementById('projectDateFrom'),
                    i18n: i18nObject,
                    onSelect: function() {
                        document.createTextNode(this.getMoment().format('Do MMMM YYYY') + ' ');
                    }
                });
                new Pikaday(
                {
                    field: document.getElementById('projectDateTo'),
                    i18n: i18nObject,
                    onSelect: function() {
                        document.createTextNode(this.getMoment().format('Do MMMM YYYY') + ' ');
                    }
                });
            </script>
    </div>
{% endblock %}